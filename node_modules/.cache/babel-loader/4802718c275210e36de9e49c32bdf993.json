{"ast":null,"code":"var _jsxFileName = \"/Users/talbachar/Desktop/MeetingGround/src/calendar/connect.tsx\";\nimport React, { useState, useEffect } from \"react\";\nimport { config } from \"../apiGoogleconfig.json\";\nimport moment from \"moment\";\nimport MyCalendar from \"../pages/Moment\";\nimport styled from \"@emotion/styled\";\nimport \"react-big-calendar/lib/css/react-big-calendar.css\";\nimport { useMutation } from \"react-apollo\";\nimport { gql } from \"apollo-boost\"; //yarn add @types/gapi\n//yarn add @types/gapi.auth2\n//yarn add @types/gapi.client.calendar\n\nconst AppendHostToDB = gql`\n  mutation addHost(\n    $fname: String!\n    $lname: String!\n    $email: String!\n    $GOA_code: String!\n  ) {\n    addHost(Fname: $fname, Lname: $lname, email: $email, GOA_code: $GOA_code) {\n      Lname\n      email\n    }\n  }\n`;\n\nconst ConnectPage = () => {\n  const [isSigned, setIsSigned] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [picUrl, setPicUrl] = useState(\"\");\n  const [email, setEmail] = useState(\"\"); //user email\n\n  const [fname, setFname] = useState(\"\"); //user fname\n\n  const [lname, setLname] = useState(\"\"); //user lname\n\n  const [GOA_code, setGOAcode] = useState(\"\"); //user Google Offline Access code\n\n  const [message, setMessage] = useState(\"\");\n  const [myEvents, setMyEvents] = useState([]);\n  const [authorizeButton, setAuthorizeButton] = useState(\"\");\n  const [signoutButton, setSignoutButton] = useState(\"\");\n  const [mutate] = useMutation(AppendHostToDB);\n  useEffect(() => {\n    async function addHostToDb() {\n      // GOA_code --> Google Offline Access code\n      const arg = await mutate({\n        variables: {\n          fname,\n          lname,\n          email,\n          GOA_code\n        }\n      });\n      console.log(arg);\n    }\n\n    if (GOA_code && fname && lname && email) {\n      addHostToDb().then(() => {\n        console.log(\"appended successfully\");\n      }).catch(err => {\n        console.log(\"an error happened\");\n      });\n    }\n  }, [GOA_code, fname, lname, email]); //On load, called to load the auth2 library and API client library.\n\n  useEffect(() => {\n    gapi.load(\"client:auth2\", initClient);\n  }, []);\n  /*\n  --> [] call the function only one time at the beginning\n  function handleClientLoad() {\n    gapi.load(\"client:auth2\", initClient);\n  }\n  */\n\n  /**\n   *  Initializes the API client library and sets up sign-in state\n   *  listeners.\n   */\n\n  function initClient() {\n    gapi.client.init({\n      apiKey: config.apiKey,\n      clientId: config.clientId,\n      discoveryDocs: config.discoveryDocs,\n      scope: config.scope\n    }).then(function () {\n      // Listen for sign-in state changes.\n      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus); // Handle the initial sign-in state.\n\n      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()); //authorizeButton.onclick = handleAuthClick;\n      //signoutButton.onclick = handleSignoutClick;\n    }, function (error) {\n      // setMessage(JSON.stringify(error, null, 2));\n      // const temp: string = JSON.stringify(error, null, 2);\n      // message += temp;\n      console.log(JSON.stringify(error, null, 2));\n    });\n  }\n  /**\n   *  Sign in the user upon button click.\n   */\n\n\n  function handleAuthClick(event) {\n    // Granting access when the user is offline\n    gapi.auth2.getAuthInstance().grantOfflineAccess().then(function (response) {\n      gapi.auth2.getAuthInstance().signIn();\n\n      if (response.code) {\n        // Hide the sign-in button now that the user is authorized, for example:\n        setAuthorizeButton(\"none\");\n        console.log(response);\n        setGOAcode(response.code);\n        console.log(\"After host added/found\");\n      } else {\n        console.log(\"THERE WAS AN ERROR\");\n      }\n    }); //gapi.auth2.getAuthInstance().signIn();\n  }\n  /**\n   *  Sign out the user upon button click.\n   */\n\n\n  function handleSignoutClick(event) {\n    gapi.auth2.getAuthInstance().signOut();\n  } //calendar.settings.readonly scope allowed\n\n  /**\n   *  Called when the signed in status changes, to update the UI\n   *  appropriately. After a sign-in, the API is called.\n   */\n\n\n  function updateSigninStatus(isSignedIn) {\n    if (isSignedIn) {\n      setAuthorizeButton(\"none\");\n      setSignoutButton(\"block\");\n      setIsSigned(true);\n      setName(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName());\n      setFname(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getGivenName());\n      setLname(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getFamilyName());\n      setEmail(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail());\n      setPicUrl(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getImageUrl());\n      listUpcomingEvents();\n      console.log(\"SIGNED IN\");\n    } else {\n      console.log(\"SIGNED OUT\");\n      setIsSigned(false);\n      setName(\"\");\n      setPicUrl(\"\");\n      setFname(\"\");\n      setLname(\"\");\n      setEmail(\"\");\n      setAuthorizeButton(\"block\");\n      setSignoutButton(\"none\");\n    }\n  }\n\n  const CalendarCard = styled.div`\n    margin: 0 auto;\n    width: 1000px;\n    height: 1000px;\n    align-items: center;\n    border-radius: 15px;\n  `;\n  /**\n   * Print the summary and start datetime/date of the next ten events in\n   * the authorized user's calendar. If no events are found an\n   * appropriate message is printed.\n   */\n\n  function listUpcomingEvents() {\n    gapi.client.calendar.events.list({\n      calendarId: \"primary\",\n      timeMin: new Date().toISOString(),\n      showDeleted: false,\n      singleEvents: true,\n      maxResults: 10,\n      orderBy: \"startTime\"\n    }).then(function (response) {\n      const events = response.result.items;\n      const appointments = response.result.items;\n\n      for (let j = 0; j < appointments.length; j++) {\n        appointments[j].start = moment.utc(appointments[j].start.dateTime).toDate();\n        appointments[j].end = moment.utc(appointments[j].end.dateTime).toDate();\n      }\n\n      setMyEvents(appointments); //setMyEvents(events);\n      // debugger;\n\n      const tmp = message;\n      setMessage(tmp + \"Upcoming events:\" + \"\\n\");\n      console.log(\"Upcoming events:\");\n      console.log(events.length);\n\n      if (events.length > 0) {\n        let i;\n\n        for (i = 0; i < events.length; i++) {\n          let event = events[i];\n          let when = event.start.dateTime;\n\n          if (!when) {\n            when = event.start.date;\n          }\n\n          const temp = message + event.summary + \" (\" + when + \")\" + \"\\n\";\n          setMessage(temp); // message += temp;\n\n          console.log(event.summary + \" (\" + when + \")\");\n        }\n      } else {\n        setMessage(\"No upcoming events found.\" + \"\\n\"); // message += \"No upcoming events found.\" + \"\\n\";\n\n        console.log(\"No upcoming events found.\");\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      padding: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    id: \"logo\",\n    src: \"./logo.png\",\n    alt: \"Meeting Ground Logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 9\n    }\n  }, \"Welcome to Meeting Ground\"), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }, \"Where Meetings hit the Ground\"), /*#__PURE__*/React.createElement(\"small\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 9\n    }\n  }, \"Main Page\")), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    id: \"authorize_button\",\n    onClick: handleAuthClick,\n    style: {\n      display: authorizeButton\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 9\n    }\n  }, \"Sign in\"), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"signout_button\",\n    onClick: handleSignoutClick,\n    style: {\n      display: signoutButton\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 9\n    }\n  }, \"Sign Out\")), isSigned && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 13\n    }\n  }, \"Welcome \", name), /*#__PURE__*/React.createElement(\"img\", {\n    src: picUrl,\n    alt: \"Avatar.\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    id: \"continue\",\n    href: \"http://localhost:3000/home\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 15\n    }\n  }, \"continue to Meeting Ground\"))), /*#__PURE__*/React.createElement(\"pre\", {\n    id: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(CalendarCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(MyCalendar, {\n    myList: myEvents,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 13\n    }\n  }))));\n};\n\nexport default ConnectPage;","map":{"version":3,"sources":["/Users/talbachar/Desktop/MeetingGround/src/calendar/connect.tsx"],"names":["React","useState","useEffect","config","moment","MyCalendar","styled","useMutation","gql","AppendHostToDB","ConnectPage","isSigned","setIsSigned","name","setName","picUrl","setPicUrl","email","setEmail","fname","setFname","lname","setLname","GOA_code","setGOAcode","message","setMessage","myEvents","setMyEvents","authorizeButton","setAuthorizeButton","signoutButton","setSignoutButton","mutate","addHostToDb","arg","variables","console","log","then","catch","err","gapi","load","initClient","client","init","apiKey","clientId","discoveryDocs","scope","auth2","getAuthInstance","isSignedIn","listen","updateSigninStatus","get","error","JSON","stringify","handleAuthClick","event","grantOfflineAccess","response","signIn","code","handleSignoutClick","signOut","currentUser","getBasicProfile","getName","getGivenName","getFamilyName","getEmail","getImageUrl","listUpcomingEvents","CalendarCard","div","calendar","events","list","calendarId","timeMin","Date","toISOString","showDeleted","singleEvents","maxResults","orderBy","result","items","appointments","j","length","start","utc","dateTime","toDate","end","tmp","i","when","date","temp","summary","padding","display"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { config } from \"../apiGoogleconfig.json\";\nimport moment from \"moment\";\nimport MyCalendar from \"../pages/Moment\";\nimport styled from \"@emotion/styled\";\nimport \"react-big-calendar/lib/css/react-big-calendar.css\";\nimport { useMutation } from \"react-apollo\";\nimport { gql } from \"apollo-boost\";\n\n//yarn add @types/gapi\n//yarn add @types/gapi.auth2\n//yarn add @types/gapi.client.calendar\n\nconst AppendHostToDB = gql`\n  mutation addHost(\n    $fname: String!\n    $lname: String!\n    $email: String!\n    $GOA_code: String!\n  ) {\n    addHost(Fname: $fname, Lname: $lname, email: $email, GOA_code: $GOA_code) {\n      Lname\n      email\n    }\n  }\n`;\n\nconst ConnectPage = () => {\n  const [isSigned, setIsSigned] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [picUrl, setPicUrl] = useState(\"\");\n  const [email, setEmail] = useState(\"\"); //user email\n  const [fname, setFname] = useState(\"\"); //user fname\n  const [lname, setLname] = useState(\"\"); //user lname\n  const [GOA_code, setGOAcode] = useState(\"\"); //user Google Offline Access code\n  const [message, setMessage] = useState(\"\");\n  const [myEvents, setMyEvents] = useState<any[]>([]);\n  const [authorizeButton, setAuthorizeButton] = useState(\"\");\n  const [signoutButton, setSignoutButton] = useState(\"\");\n  const [mutate] = useMutation(AppendHostToDB);\n\n  useEffect(() => {\n    async function addHostToDb() {\n      // GOA_code --> Google Offline Access code\n      const arg = await mutate({\n        variables: { fname, lname, email, GOA_code },\n      });\n      console.log(arg);\n    }\n    if (GOA_code && fname && lname && email) {\n      addHostToDb()\n        .then(() => {\n          console.log(\"appended successfully\");\n        })\n        .catch((err) => {\n          console.log(\"an error happened\");\n        });\n    }\n  }, [GOA_code, fname, lname, email]);\n\n  //On load, called to load the auth2 library and API client library.\n  useEffect(() => {\n    gapi.load(\"client:auth2\", initClient);\n  }, []);\n\n  /*\n  --> [] call the function only one time at the beginning\n  function handleClientLoad() {\n    gapi.load(\"client:auth2\", initClient);\n  }\n*/\n  /**\n   *  Initializes the API client library and sets up sign-in state\n   *  listeners.\n   */\n  function initClient() {\n    gapi.client\n      .init({\n        apiKey: config.apiKey,\n        clientId: config.clientId,\n        discoveryDocs: config.discoveryDocs,\n        scope: config.scope,\n      })\n      .then(\n        function () {\n          // Listen for sign-in state changes.\n          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);\n\n          // Handle the initial sign-in state.\n          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());\n          //authorizeButton.onclick = handleAuthClick;\n          //signoutButton.onclick = handleSignoutClick;\n        },\n        function (error: any) {\n          // setMessage(JSON.stringify(error, null, 2));\n          // const temp: string = JSON.stringify(error, null, 2);\n          // message += temp;\n          console.log(JSON.stringify(error, null, 2));\n        }\n      );\n  }\n\n  /**\n   *  Sign in the user upon button click.\n   */\n  function handleAuthClick(event: any) {\n    // Granting access when the user is offline\n    gapi.auth2\n      .getAuthInstance()\n      .grantOfflineAccess()\n      .then(function (response: any) {\n        gapi.auth2.getAuthInstance().signIn();\n        if (response.code) {\n          // Hide the sign-in button now that the user is authorized, for example:\n          setAuthorizeButton(\"none\");\n          console.log(response);\n          setGOAcode(response.code);\n          console.log(\"After host added/found\");\n        } else {\n          console.log(\"THERE WAS AN ERROR\");\n        }\n      });\n    //gapi.auth2.getAuthInstance().signIn();\n  }\n\n  /**\n   *  Sign out the user upon button click.\n   */\n  function handleSignoutClick(event: any) {\n    gapi.auth2.getAuthInstance().signOut();\n  }\n\n  //calendar.settings.readonly scope allowed\n  /**\n   *  Called when the signed in status changes, to update the UI\n   *  appropriately. After a sign-in, the API is called.\n   */\n  function updateSigninStatus(isSignedIn: boolean) {\n    if (isSignedIn) {\n      setAuthorizeButton(\"none\");\n      setSignoutButton(\"block\");\n      setIsSigned(true);\n      setName(\n        gapi.auth2\n          .getAuthInstance()\n          .currentUser.get()\n          .getBasicProfile()\n          .getName()\n      );\n      setFname(\n        gapi.auth2\n          .getAuthInstance()\n          .currentUser.get()\n          .getBasicProfile()\n          .getGivenName()\n      );\n      setLname(\n        gapi.auth2\n          .getAuthInstance()\n          .currentUser.get()\n          .getBasicProfile()\n          .getFamilyName()\n      );\n      setEmail(\n        gapi.auth2\n          .getAuthInstance()\n          .currentUser.get()\n          .getBasicProfile()\n          .getEmail()\n      );\n      setPicUrl(\n        gapi.auth2\n          .getAuthInstance()\n          .currentUser.get()\n          .getBasicProfile()\n          .getImageUrl()\n      );\n      listUpcomingEvents();\n      console.log(\"SIGNED IN\");\n    } else {\n      console.log(\"SIGNED OUT\");\n      setIsSigned(false);\n      setName(\"\");\n      setPicUrl(\"\");\n      setFname(\"\");\n      setLname(\"\");\n      setEmail(\"\");\n      setAuthorizeButton(\"block\");\n      setSignoutButton(\"none\");\n    }\n  }\n\n  const CalendarCard = styled.div`\n    margin: 0 auto;\n    width: 1000px;\n    height: 1000px;\n    align-items: center;\n    border-radius: 15px;\n  `;\n\n  /**\n   * Print the summary and start datetime/date of the next ten events in\n   * the authorized user's calendar. If no events are found an\n   * appropriate message is printed.\n   */\n  function listUpcomingEvents() {\n    gapi.client.calendar.events\n      .list({\n        calendarId: \"primary\",\n        timeMin: new Date().toISOString(),\n        showDeleted: false,\n        singleEvents: true,\n        maxResults: 10,\n        orderBy: \"startTime\",\n      })\n      .then(function (response: any) {\n        const events: any[] = response.result.items;\n        const appointments = response.result.items;\n        for (let j = 0; j < appointments.length; j++) {\n          appointments[j].start = moment\n            .utc(appointments[j].start.dateTime)\n            .toDate();\n          appointments[j].end = moment\n            .utc(appointments[j].end.dateTime)\n            .toDate();\n        }\n        setMyEvents(appointments);\n\n        //setMyEvents(events);\n        // debugger;\n        const tmp: string = message;\n        setMessage(tmp + \"Upcoming events:\" + \"\\n\");\n        console.log(\"Upcoming events:\");\n        console.log(events.length);\n        if (events.length > 0) {\n          let i: number;\n          for (i = 0; i < events.length; i++) {\n            let event = events[i];\n            let when = event.start.dateTime;\n            if (!when) {\n              when = event.start.date;\n            }\n            const temp: string =\n              message + event.summary + \" (\" + when + \")\" + \"\\n\";\n            setMessage(temp);\n            // message += temp;\n            console.log(event.summary + \" (\" + when + \")\");\n          }\n        } else {\n          setMessage(\"No upcoming events found.\" + \"\\n\");\n          // message += \"No upcoming events found.\" + \"\\n\";\n          console.log(\"No upcoming events found.\");\n        }\n      });\n  }\n\n  return (\n    <div style={{ padding: \"1rem\" }}>\n      <div>\n        <img id=\"logo\" src=\"./logo.png\" alt=\"Meeting Ground Logo\" />\n        <h1>Welcome to Meeting Ground</h1>\n        <h2>Where Meetings hit the Ground</h2>\n        <small>Main Page</small>\n      </div>\n      <div>\n        <button\n          id=\"authorize_button\"\n          onClick={handleAuthClick}\n          style={{ display: authorizeButton }}\n        >\n          Sign in\n        </button>\n        <button\n          id=\"signout_button\"\n          onClick={handleSignoutClick}\n          style={{ display: signoutButton }}\n        >\n          Sign Out\n        </button>\n      </div>\n\n      {isSigned && (\n        <div>\n          <div>\n            <h1>Welcome {name}</h1>\n            <img src={picUrl} alt=\"Avatar.\" />\n            <p>\n              <a id=\"continue\" href=\"http://localhost:3000/home\">\n                continue to Meeting Ground\n              </a>\n            </p>\n          </div>\n          <pre id=\"content\"></pre>\n          <CalendarCard>\n            <MyCalendar myList={myEvents} />\n          </CalendarCard>\n        </div>\n      )}\n    </div>\n  );\n};\nexport default ConnectPage;\n"]},"metadata":{},"sourceType":"module"}